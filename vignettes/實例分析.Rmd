---
title: "實例分析"
author: "CHUNG-E LO"
output: rmarkdown::html_vignette
date: "`r Sys.Date()`"
vignette: >
  %\VignetteIndexEntry{A Quick Introduction to iNEXT.link via Examples}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE, warning=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  warning = FALSE, message = FALSE,
  comment = ""
)
#devtools::load_all(".")
library(ggplot2)
#library(kableExtra)
library(knitr)
library(tibble)
library(iNEXT)
library(sets)

Shelfanger <- read.table("F://Chao//Network diversity//shinyapp//heir.entropy//data//Shelfanger.txt")
Hickling <- read.table("F://Chao//Network diversity//shinyapp//heir.entropy//data/Hickling.txt")
Norfolk <- list(Shelfanger = Shelfanger,Hickling = Hickling)
# usethis::use_data(Norfolk, overwrite = T)

Caguana <- read.table("F://Chao//Network diversity//shinyapp//heir.entropy//data/Caguana.txt")
Cialitos <- read.table("F://Chao//Network diversity//shinyapp//heir.entropy//data/Cialitos.txt")
Cordillera <- read.table("F://Chao//Network diversity//shinyapp//heir.entropy//data/Cordillera.txt")
Fronton <- read.table("F://Chao//Network diversity//shinyapp//heir.entropy//data/Fronton.txt")
data <- list(Cordillera = Cordillera,Caguana = Caguana,Fronton = Fronton,Cialitos = Cialitos)

library(phytools)
rowtree <- read.newick("F://Chao//Network diversity//shinyapp//heir.entropy//tree/rowtree.txt")
coltree <- read.newick("F://Chao//Network diversity//shinyapp//heir.entropy//tree/coltree.txt")

puerto.rico = list()
puerto.rico[["data"]] = data
puerto.rico[["col.tree"]] = coltree
puerto.rico[["row.tree"]] = rowtree
# usethis::use_data(puerto.rico, overwrite = T)
```

`iNEXT.link` is a R package providing the rarefaction/extrapolation and asymptotic estimation to achieve fair comparison of network diversity among multiple interaction network. In this document, we provide a quick introduction demonstrating how to run `iNEXT.link`. The Detailed information about `iNEXT.link` functions is described in the `iNEXT.link` Manual, also available in [CRAN](https://cran.r-project.org/package=PhD). An online version of `iNEXT.link.Online` (<https://r717r717.shinyapps.io/iNEXT.link.Online/>) is developed for users without R background. The theoretical derivation of network diversity measurements will be proposed soon. `iNEXT.link` is an extension for [`iNext3D`](https://cran.r-project.org/package=iNext), which computes diversity estimates and its confidence intervals for the two types of rarefaction and extrapolation (R/E) based on two different sampling data sets, individual-based abundance data and quadrat-based incidence data.


Based on the <Network diversity: Statistical esitmation and software development>, for single network, we have a 4-steps procedure to analyze comprehensively, which are 

1. Assessment of sample completeness  
2. The asymptotic approach
3. Non-asymptotic coverage-based rarefaction and extrapolation analysis     
4: Assement of network specialization

Moreover, to assess the dissimilarity between interaction networks, we have an extra step

  (*) beta diversity and dissimilarity indices.


For these analyzing steps, we have corresponding computation functions, and we will go through these functions by steps.


根據我們前述的四步驟分析,

對於單一網路的資料，我們可以考慮以下的分析步驟  

1. 樣本涵蓋率的評估
2. 漸近法
3. 樣本涵蓋率稀釋與預測
4. 網路專一性

```{r, echo = F}
# library(iNEXT)
# source("..//R//iNEXTlink.R")
# source("..//R//subfunction.R")
# source("..//R//myfunc.R")
# library(chaoUtility)
library(tidyr)
library(magrittr)
library(miNEXT.beta)
library(chaoUtility)
library(phytools)
library(iNEXT3D)
library(iNEXT.link)
library(miNEXT.beta)
library(tidyverse)
library(phytools)

library(ade4)
library(ape)
library(dplyr)
```


```{r, echo  =F}

Shelfanger <- read.table("F://Chao//Network diversity//shinyapp//heir.entropy//data//Shelfanger.txt")
Hickling <- read.table("F://Chao//Network diversity//shinyapp//heir.entropy//data/Hickling.txt")
Norfolk <- list(Shelfanger = Shelfanger,Hickling = Hickling)

Caguana <- read.table("F://Chao//Network diversity//shinyapp//heir.entropy//data/Caguana.txt")
Cialitos <- read.table("F://Chao//Network diversity//shinyapp//heir.entropy//data/Cialitos.txt")
Cordillera <- read.table("F://Chao//Network diversity//shinyapp//heir.entropy//data/Cordillera.txt")
Fronton <- read.table("F://Chao//Network diversity//shinyapp//heir.entropy//data/Fronton.txt")
data <- list(Cordillera = Cordillera,Caguana = Caguana,Fronton = Fronton,Cialitos = Cialitos)
puerto.rico <- list(Cordillera = Cordillera,Caguana = Caguana,Fronton = Fronton,Cialitos = Cialitos)

rowtree <- read.newick("F://Chao//Network diversity//shinyapp//heir.entropy//tree/rowtree.txt")
coltree <- read.newick("F://Chao//Network diversity//shinyapp//heir.entropy//tree/coltree.txt")

puerto.rico = list()
puerto.rico[["data"]] = data
puerto.rico[["col.tree"]] = coltree
puerto.rico[["row.tree"]] = rowtree
```


## 例子一、Norfolk英國草地資料

### 步驟一、樣本涵蓋率的評估
### 步驟二、漸近法
### 步驟三、樣本涵蓋率稀釋與預測
### 步驟四、網路專一性




## 例子二、波多黎各鳥類捕蟲資料

### 步驟一、樣本涵蓋率的評估
### 步驟二、漸近法
### 步驟三、樣本涵蓋率稀釋與預測
### 步驟四、網路專一性




<br><font size="5"><b>iNEXT.link VIA EXAMPLES: Network diversity analysis (taxonomic)</b></font>
-------------------

```{r, echo=FALSE, results='hide', warning=FALSE, message=FALSE}
library(ade4)
library(tidyverse)
library(ape)
library(dplyr)
```


### Main function: 

### 1.`NetSC()`: 

```{r,eval=T, message = F, warning=F}
sc1 <- NetSC(x = Norfolk, datatype = "abundance", nboot = 10)
```

```{r}
ggNetSC(sc1)
```

### 2.`iNEXT_ND()`: 


```{r,eval=T, message = F, warning=F}
sample1 <- iNEXT_ND(x = Norfolk, datatype = "abundance", nboot = 30)
```

`iNEXT_ND()` returns a list containing three objects:

* `$DataInfo`: The same table from function **NDInfo()**, which summarizes some network statistics for each assemblage, including reference sample size (`n`), number of observed species (`S.obs`), Connectance, the first two rare species frequency counts.

```{r}
kable(sample1$DataInfo)
```


* `$iNextEst`: Size-based / coverage-based diversity estimates along with confidence intervals and related statistics. 

#### size-based
```{r}
kable(head(sample1$iNextEst$size_based,5))
```

#### coverage-based
```{r}
kable(head(sample1$iNextEst$coverage_based,5))
```


* `$AsyEst`: Asymptotic/ Empirical diversity estimates along with confidence intervals and related statistics.

```{r}
kable(head(sample1$AsyEst,9))
```


```{r, eval=FALSE, echo = F}
# only show part of the table, call View(dunes_iNEXT$size_based) to see full table.
# sample_iNEXT$DataInfo
# sample_iNEXT$iNextEst
# sample_iNEXT$AsyEst
```

### 3. ggiNEXT_ND

To visualize the curves, use `ggiNEXT_ND` to obtain plots based on `ggplot2` package. This function provides three types of curves, which can be specified in the argument `plot.type`: 
 
1. Sample-size-based rarefaction and extrapolation curve (`plot.type = 1`): sampling curve depicting phylogenetic diversity estimates as a function of sample size.
2. Sample completeness curve (`plot.type = 2`): the curve of sample coverage as a function of sample size.
3. Coverage-based R/E curve (`plot.type = 3`): sampling curve depicting Network diversity estimates as a function of sample coverage.

```{r,echo = TRUE ,fig.width=7, fig.height=4, fig.align="center",warning=FALSE}
ggiNEXT_ND(sample1, type = 1,facet = "Order.q" )
```

```{r,echo = TRUE ,fig.width=7, fig.height=4, fig.align="center",warning=FALSE}
ggiNEXT_ND(sample1, type = 3, facet = "Assemblage")
```


### 4. Empirical / Asymptotic diversity

```{r}
asy1 = AsyND(Norfolk,q = c(0,1,2),nboot = 10)
head(asy1,5)
```

```{r}
obs1 = ObsND(Norfolk,q = c(0,1,2),nboot = 10)
head(obs1,5)
```

```{r,echo = TRUE ,fig.width=6, fig.height=4, fig.align="center",warning=FALSE}
ggAsyND(rbind(obs1, asy1))
```

### 5. `estimateND()`

```{r, eval = T}
kable(estimateND(Norfolk, datatype="abundance", base="coverage",level=0.7, conf=0.95))
```

The `estimateND()` function returns a table of the computed diversity for specified/default diversity orders `q` and reference times for the user-specified values of sample coverage. The corresponding sample sizes and sample coverage values are also provided.


### 6. Specialization

```{r, warning=F, message=F}
spec1 = NetSpec(Norfolk, q = seq(0,2,1), datatype = "abundance", nboot =10)
```

```{r,echo = TRUE ,fig.width=7, fig.height=4, fig.align="center",warning=FALSE}
ggSpec(spec1)
```


### 7. Dissimilarity

```{r}
dissimilarity1 = iNEXT_beta_link(x = Norfolk, coverage_expected = seq(0.5,1,0.05),
                                 data_type='abundance',
                                 q = c(0, 1, 2),level='taxonomic',
                                 nboot = 0, conf = 0.95, max_alpha_coverage=F, by='coverage')
```


```{r,echo = TRUE ,fig.width=7, fig.height=4, fig.align="center",warning=FALSE}
ggiNEXT_beta_link(dissimilarity1, type = 'B')
ggiNEXT_beta_link(dissimilarity1, type = 'D')
```

```{r}
kable(head(dissimilarity1$Region_1$gamma, 10))
kable(head(dissimilarity1$Region_1$alpha, 10))
kable(head(dissimilarity1$Region_1$beta, 10))
```

<br><font size="5"><b>EXAMPLES2: Network diversity analysis (phylogenetic) </b></font>
-------------------

### Main function: 

### 1.`NetSC()`: 

```{r,eval=T, message = F, warning=F}
sc2 <- NetSC(x = Norfolk, datatype = "abundance", nboot = 10)
```

### 2.`iNEXT_PND()`: 

```{r,eval=T, message = F, warning=F}
sample2 <- iNEXT_PND(x = puerto.rico$data, datatype = "abundance", 
                     row.tree = rowtree, col.tree = coltree, nboot = 10)
```

`iNEXT_PND()` returns a list containing three objects:

* `$DataInfo`: The same table from function **PNDInfo()**, which summarizes some network statistics for each assemblage, including reference sample size (`n`), number of observed species (`S.obs`), Connectance, the first two rare species frequency counts.

```{r}
kable(sample2$DataInfo)
```


* `$iNextEst`: Size-based / coverage-based diversity estimates along with confidence intervals and related statistics. 

#### size-based
```{r}
kable(head(sample2$iNextEst, 5)%>%rbind(tail(sample2$iNextEst, 5)))
```




* `$AsyEst`: Asymptotic/ Empirical diversity estimates along with confidence intervals and related statistics.

```{r}
kable(head(sample2$AsyEst,9))
```

### 3. ggiNEXT_PND

To visualize the curves, use `ggiNEXT_PND` to obtain plots based on `ggplot2` package. This function provides three types of curves, which can be specified in the argument `plot.type`: 
 
1. Sample-size-based rarefaction and extrapolation curve (`plot.type = 1`): sampling curve depicting phylogenetic diversity estimates as a function of sample size.
2. Sample completeness curve (`plot.type = 2`): the curve of sample coverage as a function of sample size.
3. Coverage-based R/E curve (`plot.type = 3`): sampling curve depicting Network diversity estimates as a function of sample coverage.

```{r,echo = TRUE ,fig.width=7, fig.height=4, fig.align="center",warning=FALSE}
ggiNEXT_PND(sample2, type = 1)
```


```{r,echo = TRUE ,fig.width=7, fig.height=4, fig.align="center",warning=FALSE}
ggiNEXT_PND(sample2, type = 3)
```


<!-- ### 4. Empirical / Asymptotic diversity -->

<!-- ```{r} -->
<!-- asy1 = AsyPND(Norfolk,q = c(0,1,2),nboot = 10) -->
<!-- head(asy1,5) -->
<!-- ``` -->

<!-- ```{r} -->
<!-- obs1 = ObsND(Norfolk,q = c(0,1,2),nboot = 10) -->
<!-- head(obs1,5) -->
<!-- ``` -->

<!-- ```{r,echo = TRUE ,fig.width=6, fig.height=4, fig.align="center",warning=FALSE} -->
<!-- ggAsyND(rbind(obs1, asy1)) -->
<!-- ``` -->

 
### 4. `estimatePND()`

```{r, eval = T}
kable(estimatePND(puerto.rico$data, col.tree = coltree, row.tree = rowtree, nboot = 10,datatype="abundance",level=0.7, conf=0.95))
```

<!-- The `estimateND()` function returns a table of the computed diversity for specified/default diversity orders `q` and reference times for the user-specified values of sample coverage. The corresponding sample sizes and sample coverage values are also provided. -->


### 5. Specialization

```{r}
spec2 = phySpec(puerto.rico$data, q= seq(0,2,1), datatype = "abundance", nboot = 30, E = 1:5, method = "Estimated", C = 0.9)
```

```{r,echo = TRUE ,fig.width=7, fig.height=4, fig.align="center",warning=FALSE}
ggSpec(spec2)
```


### 6. Dissimilarity

#### taxonomic

```{r}
dissimilarity2 = iNEXT_beta_link(puerto.rico$data, coverage_expected = seq(0.5,1,0.025), data_type='abundance',
                                 q = c(0, 1, 2),level='taxonomic', 
                                 row.tree = rowtree,col.tree = coltree,
                                 nboot = 0, conf = 0.95, max_alpha_coverage=F, 
                                 by='coverage')
```


```{r,echo = TRUE ,fig.width=7, fig.height=4, fig.align="center",warning=FALSE}
ggiNEXT_beta_link(dissimilarity2, type = 'B')
ggiNEXT_beta_link(dissimilarity2, type = 'D')
```


```{r}
kable(head(dissimilarity2$Region_1$gamma, 10))
kable(head(dissimilarity2$Region_1$alpha, 10))
kable(head(dissimilarity2$Region_1$beta, 10))
```

#### phylogenetic

```{r, warning=F, message=F}
dissimilarity3 = iNEXT_beta_link(x = puerto.rico$data, coverage_expected = seq(0.5,0.99,0.025), data_type='abundance',
                                 q = c(0, 1, 2),level='phylogenetic', 
                                 row.tree = rowtree, col.tree = coltree,
                                 nboot = 0, conf = 0.95, max_alpha_coverage=F, 
                                 by='coverage')
```


```{r,echo = TRUE ,fig.width=7, fig.height=4, fig.align="center",warning=FALSE}
ggiNEXT_beta_link(dissimilarity3, type = 'B')
ggiNEXT_beta_link(dissimilarity3, type = 'D')
```


```{r}
kable(head(dissimilarity3$Region_1$gamma, 10))
kable(head(dissimilarity3$Region_1$alpha, 10))
kable(head(dissimilarity3$Region_1$beta, 10))
```





<br><font size="4"><b>License</b></font>
-------------------
The iNEXT.link package is licensed under the GPLv3. To help refine `iNEXT.link`, your comments or feedbacks would be welcome (please send them to Anne Chao).

<br><font size="4"><b>How to cite</b></font>
-------------------
If you publish your work based on results from `iNEXT.link` (R package), please make reference to Chao et al. given in the following list.

<br><font size="4"><b>Reference</b></font>
-------------------
- Chao, A., Chiu C.-H. and Jost, L. (2010). Phylogenetic diversity measures based on Hill numbers. Philosophical Transactions of the Royal Society B., 365, 3599-3609.
- Chao, A., Chiu, C.-H., Hsieh, T. C., Davis, T., Nipperess, D., and Faith, D. (2015) Rarefaction and extrapolation of phylogenetic diversity. Methods in Ecology and Evolution, 6, 380-388.
- Hsieh, T. C. and Chao, A. (2017). Rarefaction and extrapolation: making fair comparison of abundance-sensitive phylogenetic diversity among multiple assemblages. Systematic Biology 66, 100-111.


```{r}


```
